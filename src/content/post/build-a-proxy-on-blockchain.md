---
title: "在区块链上部署代理节点"
publishDate: "17 Dec 2024"
description: "上周在配置本地代理的时候产生了一个点子就是能不能把代理节点放到区块链上，这样就不需要到处去买机场服务，找到最快的线路最便宜的节点，尤其是某个机场被封锁的话，基本所有节点就废了"
tags: ["blockchain", "web3", "proxy"]
---

在[上周的博客](/posts/journal/week2)中讲到了这个想法，所谓的机场就是卖服务器的ip，有没办法把自己限制的vps上的闲置的带宽共享出来，自己用不完能让别人也能用呢？

共享经济很美好，但是要解决这个问题必须解决收费的问题，不可能白白分享我的带宽给别人用吧，那么收费的话该怎么收，像滴滴一样让每个车主注册为滴滴司机，然后平台给发钱吗？没这个能力做这个事。区块链就是好办法，让每个翻墙节点都成为区块链矿工，你给别人提供代理服务的同时，会收到区块链挖矿奖励。而客户端要使用区块链节点的翻墙服务，必须要锁定一部分资金到区块链上，由智能合约每天抠出一部分费用。

## 方案设计

### 选项一 使用智能合约来管理代理节点

区块链上的VPN有很多实现，能不能不自建区块链，而是使用现有的区块链来实现呢？

要复用现有的区块链如：ETH、SOL, polkadot，就需要先实现一个管理费用的智能合约，部署到区块链上，然后让VPN节点定时跟这个合约交互，获取最新的代理信息。

这个过程有一个重要的问题就是不能处理恶意诈骗问题。比如说节点 A 在智能合约上注册自己为服务器节点，节点 B 通过智能合约获取到节点 A 的信息，但是节点 A 并没有提供服务，这个时候节点 B 就会损失一定的费用，更有甚者如果节点A是恶意节点，那么节点B的数据可能会被窃取，或者流量费用被篡改。

因此智能合约无法解决如下问题：

1. 链下代理服务和链上计费数据一致性的问题
2. 定时上报代理服务在线状态问题

### 选项二 将代理软件集成到区块链节点上

上面讨论了如果区块链节点跟代理节点分开的话，会有恶意节点的问题，那么我们可以将代理软件集成到区块链节点上，这样就不会有恶意节点的问题了。如果有人作恶部署了一个恶意节点，区块链的特性会让这个节点没法连上网络。

用户如何付费呢？我的一个想法是用户将部分资产转存到区块链上，每次出块期间，随机从这部分资产中扣除，直到用户余额被扣完说明会员到期

用 `polkadot-sdk` 来实现这个区块链是最简单的，polkadot节点在连上 p2p 网络的时候，会检测 peer 的版本，如果版本不对就连不上。

这个方案的好处有：

1. 区块链节点就是代理节点，避免了恶意节点问题
2. 可以将代理流量的奖励，添加到出块奖励中，这样可以实时到账，不需要等待智能合约的结算

流量计费是不可能实现的，因为代理软件不管是给智能合约还是区块链上报自己代理的流量数，都是不可信的。为此只能要求节点在线就给予奖励。

### 最终方案

部署一条自己的区块链用来跑代理软件。名字就叫 SST (Secure Socks5 Token)。每次出块奖励给予在线的节点，用户可以通过 SST 购买节点的代理服务。每一轮出块，除了币基奖励外，还从所有用户付费的资产中扣除一部分，作为节点的奖励。

共识算法就用 Aura 就行，前期是授权的节点加入，未来再考虑升级到彻底去中心化。支持几千个验证人节点不是问题
通过 telemetry 来存储节点的ip地址，然后自建一个 http server 来返回所有可用的地址

用途：

1. 拿来翻墙，有一个机场
2. 拿来做ip池，写爬虫的人可以用

要想用这个服务的人都要有 SST 代币，就算是拿来封IP，也会要付出成本，可以杜绝恶意节点对网络的攻击。

